# Kiro 硬件产品规格文档

**版本:** v1.1.2
**更新日期:** 2026-02-12
**状态:** 草稿
**参考产品:** Inku Daily Schedule Planner

---

## 目录

1. [产品概述](#1-产品概述)
2. [硬件规格](#2-硬件规格)
3. [显示页面设计](#3-显示页面设计)
4. [交互流程](#4-交互流程)
5. [宠物系统](#5-宠物系统)
6. [数据同步](#6-数据同步)
7. [4寸 vs 7.3寸差异](#7-4寸-vs-7寸差异)
8. [固件开发指南](#8-固件开发指南)

---

## 1. 产品概述

### 1.1 产品定位

Kiro 是一款面向远程工作者的习惯养成伴侣设备。通过 AI 驱动的像素宠物陪伴和游戏化任务管理，帮助用户建立健康的工作习惯。

### 1.2 核心功能

| 功能 | 描述 |
|------|------|
| 任务展示 | 显示今日任务列表，支持完成标记 |
| 宠物陪伴 | 像素风格虚拟宠物，随任务完成成长 |
| 日程提醒 | 展示日历事件和时间安排 |
| 每日结算 | 统计当日完成情况，积分奖励 |

### 1.3 产品形态

- **设备类型:** 展示型 E-ink 设备
- **尺寸规格:** 4寸 / 7.3寸 两种规格
- **交互方式:** 电源键 + 旋钮按键 + BLE 连接 iOS App
- **供电方式:** 内置电池 + USB-C 充电

### 1.4 目标用户

- 远程工作者
- 自由职业者
- 需要习惯养成的用户
- 喜欢像素风格/电子宠物的用户

---

## 2. 硬件规格

### 2.1 屏幕规格

#### 4寸屏幕

| 参数 | 规格 |
|------|------|
| 分辨率 | 400 × 600 像素 |
| 像素密度 | ~125 PPI |
| 显示技术 | E Ink Spectra 6, 4bpp 全彩色（6色） |
| 灰度级别 | 6 色（黑、白、黄、红、蓝、绿） |
| 刷新时间 | 全刷新 ~1.5s，局部刷新 ~0.3s |
| 可视角度 | 180° |

#### 7.3寸屏幕

| 参数 | 规格 |
|------|------|
| 分辨率 | 800 × 480 像素 |
| 像素密度 | ~133 PPI |
| 显示技术 | E Ink Spectra 6, 4bpp 全彩色（6色） |
| 灰度级别 | 6 色（黑、白、黄、红、蓝、绿） |
| 刷新时间 | 全刷新 ~2s，局部刷新 ~0.5s |
| 可视角度 | 180° |

#### 屏幕接口（SPI 4-wire）

| 参数 | 规格 |
|------|------|
| SPI 信号 | SCLK, MOSI, CS |
| 控制信号 | DC, RST, BUSY |
| SPI 时钟 | ≤20 MHz |

### 2.2 按键规格

#### 电源键

| 参数 | 规格 |
|------|------|
| 按键数量 | 1 个物理按键 |
| 按键类型 | 轻触按键 |
| 按键位置 | 设备侧边 (硬件团队决定) |
| 功能 | 开机/关机/进入屏保 |
| 触发力度 | 150-200gf |
| 使用寿命 | ≥100,000 次 |

#### 旋钮按键

| 参数 | 规格 |
|------|------|
| 按键数量 | 1 个旋钮按键 |
| 按键类型 | 旋转编码器 + 按压确认 |
| 按键位置 | 屏幕下方 |
| 滚动功能 | 滚动选择列表项 |
| 按压功能 | 确认选择 / 完成任务 |
| 灵敏度 | 动态调整 (根据滚动速度) |
| 选中反馈 | 反色显示 (黑底白字) |
| 刷新方式 | 局部刷新 (快速响应) |
| 使用寿命 | ≥100,000 次 |

### 2.3 主控 SoC

| 参数 | 规格 |
|------|------|
| 芯片型号 | ESP32-S3 |
| 核心 | 双核 Xtensa LX7 |
| Flash | >= 16MB（SPI NOR Flash，模组自带） |
| PSRAM | >= 2MB，推荐 4MB |
| BLE | BLE 5.0 |
| 休眠 | 支持 Deep Sleep / 外部 GPIO 唤醒 |

Flash 用途：固件程序、OTA 分区（可选）、彩色页面缓存（>=4 页）、Event Log（环形缓冲）、屏保图片、字库

PSRAM 用途：屏幕帧缓冲、BLE 分包缓存、UI 临时数据

### 2.4 RTC（实时时钟）

| 参数 | 规格 |
|------|------|
| 功能 | 离线定时唤醒、断开 BLE 后保持计时 |
| 首选方案 | ESP32-S3 内部 RTC |
| 可选方案 | 外置高精度 RTC（如 DS3231） |

### 2.5 BLE 模块

| 参数 | 规格 |
|------|------|
| 蓝牙版本 | BLE 5.0 |
| 传输距离 | ≥10m (开阔环境) |
| 服务 UUID | `0000FFE0-0000-1000-8000-00805F9B34FB` |
| 写特征 UUID | `0000FFE1-0000-1000-8000-00805F9B34FB` |
| 通知特征 UUID | `0000FFE2-0000-1000-8000-00805F9B34FB` |

### 2.6 电源管理

| 参数 | 4寸规格 | 7寸规格 |
|------|---------|---------|
| 电池容量 | 500mAh | 1000mAh |
| 待机时间 | ~30 天 | ~20 天 |
| 活跃使用 | ~7 天 | ~5 天 |
| 充电接口 | USB-C | USB-C |
| 充电时间 | ~1.5 小时 | ~2.5 小时 |

### 2.7 其他规格

| 参数 | 4寸规格 | 7寸规格 |
|------|---------|---------|
| 外壳材质 | ABS + PC | ABS + PC |
| 尺寸 (mm) | 95 × 75 × 8 | 175 × 115 × 10 |
| 重量 | ~60g | ~150g |
| 工作温度 | 0°C ~ 40°C | 0°C ~ 40°C |
| 存储温度 | -20°C ~ 60°C | -20°C ~ 60°C |

---

## 3. 显示页面设计

设备共有 4 个主要页面，通过时段自动切换或用户手动操作切换。

### 3.1 Page 1: Start of Day (早安页)

**显示时机:** 开机默认显示

**页面内容:**

```
┌─────────────────────────────────┐
│                                 │
│     [宠物像素图 - 早安姿态]      │
│                                 │
│   "Good morning! Ready for      │
│    a great day?"                │
│                                 │
│   ─────────────────────────     │
│                                 │
│   3 tasks, 2 events today.      │
│                                 │
│   Next: 09:00 Team standup      │
│                                 │
│   [天气图标] 22°C Partly Cloudy │
│                                 │
└─────────────────────────────────┘
```

**触发:** 开机默认显示
**退出:** 任意按键 → Overview

**数据字段:**

| 字段 | 最大长度 | 描述 |
|------|----------|------|
| morningGreeting | 50 字符 | 早安问候语 |
| dailySummary | 60 字符 | 今日概览 (任务/日程数量) |
| firstItem | 40 字符 | 第一项预览 (下一个日程或任务) |
| weather | - | 天气信息 (App 提供) |

### 3.2 Page 2: Overview (概览页 - 混合时间线)

**显示时机:** 从 Start of Day 按任意键进入

**页面内容:**

```
┌─────────────────────────────────┐
│  [宠物像素图]    Next: 14:00    │
│                 Product Review  │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  混合时间线                      │
│                                 │
│  09:00 Team standup (日程)      │
│  ▶ Review project proposal      │
│  10:30 Client call (日程)       │
│  ○ Send weekly report           │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  "Keep going, you're doing      │
│   great!"                       │
│                                 │
│  [滚轮滚动选择 / 按下确认]       │
└─────────────────────────────────┘
```

**排序规则:**
- 日程: 按时间排序，仅显示不可交互
- 任务: 按优先级排序，可选择进入 Task In

**显示数量:** 根据屏幕尺寸调整 (4寸/7寸不同)
**空状态:** 显示"今日无任务"提示

**交互:**
- 滚轮滚动: 选择项目 (反色高亮)
- 按下滚轮 (任务): 进入 Task In
- 按下滚轮 (日程): 显示日程详情 (自动超时返回)

**数据字段:**

| 字段 | 最大长度 | 描述 |
|------|----------|------|
| currentScheduleSummary | 30 字符 | 当前/下一个日程 |
| mixedTimeline | 动态 | 日程 + 任务混合列表 |
| companionPhrase | 40 字符 | 陪伴短句 |

### 3.3 Page 3: Task In (任务详情页)

**显示时机:** 从 Overview 选择任务进入

**页面内容:**

```
┌─────────────────────────────────┐
│                                 │
│     [宠物像素图 - 专注姿态]      │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  Current Task                   │
│                                 │
│  "Review project proposal"      │
│                                 │
│  Description: Check all items   │
│  and provide feedback           │
│                                 │
│  Estimated: 30 min              │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  "You can do this! Focus and    │
│   conquer!"                     │
│                                 │
│  [按下滚轮: 标记完成]            │
└─────────────────────────────────┘
```

**触发:** 从 Overview 选择任务进入
**交互:**
- 短按滚轮: 标记完成 → 自动返回 Overview
- 长按滚轮 (>1s): 跳过任务 → 返回 Overview

**事件同步:**
- 进入任务时: 发送 `EnterTaskIn` 事件 (带时间戳)
- 完成任务时: 发送 `CompleteTask` 事件 (带时间戳)
- 跳过任务时: 发送 `SkipTask` 事件 (带时间戳)

**数据字段:**

| 字段 | 最大长度 | 描述 |
|------|----------|------|
| taskTitle | 40 字符 | 任务标题 |
| taskDescription | 100 字符 | 任务描述 (可选) |
| estimatedDuration | 10 字符 | 预估时长 (可选) |
| encouragement | 50 字符 | 鼓励语 |

### 3.4 Page 4: Settlement (结算页)

**显示时机:** 所有任务完成时自动显示

**页面内容:**

```
┌─────────────────────────────────┐
│                                 │
│     [宠物像素图 - 开心姿态]      │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  Today's Summary                │
│                                 │
│  Tasks: 3/5 completed           │
│  Points: +50                    │
│  Streak: 7 days                 │
│                                 │
│  ─────────────────────────────  │
│                                 │
│  "Great progress today!"        │
│                                 │
│  "See you tomorrow!"            │
│                                 │
└─────────────────────────────────┘
```

**触发:** 所有任务完成时自动显示
**退出:** 任意按键 → 停留在 Overview

**数据字段:**

| 字段 | 描述 |
|------|------|
| tasksCompleted | 完成任务数 |
| tasksTotal | 总任务数 |
| pointsEarned | 获得积分 |
| streakDays | 连续天数 |
| summaryMessage | 总结语 (50 字符) |
| encouragementMessage | 鼓励语 (50 字符) |

---

### 3.5 屏保模式

**触发:** 按电源键
**内容:** 静态宠物图片 (桌面装饰)
**BLE:** 断开连接 (省电)
**退出:** 再次按电源键 → Start of Day

---

## 4. 交互流程

### 4.1 页面切换方式 (3 种)

| 触发方式 | 描述 | 目标页面 |
|----------|------|----------|
| 日程触发 | 固件唤醒 + App 响应推送新数据 | Overview |
| 按钮触发 | 滚轮选择任务 → 按下进入 | Task In |
| 屏保触发 | 按电源键进入静态屏保 | 屏保 (宠物图片) |

### 4.2 滚轮交互

#### Overview 页面

| 操作 | 响应 |
|------|------|
| 滚轮滚动 | 选择项目 (反色高亮)，纯本地处理 |
| 按下滚轮 (任务) | 进入 Task In 页面 |
| 按下滚轮 (日程) | 显示日程详情 (自动超时返回) |

#### Task In 页面

| 操作 | 响应 |
|------|------|
| 短按滚轮 | 标记任务完成，发送 CompleteTask 事件，返回 Overview |
| 长按滚轮 (>1s) | 跳过任务，发送 SkipTask 事件，返回 Overview |

#### Settlement 页面

| 操作 | 响应 |
|------|------|
| 任意按键 | 返回 Overview |

### 4.3 电源键交互

| 当前状态 | 操作 | 响应 |
|----------|------|------|
| 任意页面 | 按电源键 | 进入屏保模式 |
| 屏保模式 | 按电源键 | 返回 Start of Day |
| 关机状态 | 按电源键 | 开机，显示 Start of Day |

### 4.4 状态机

```
┌─────────────┐
│  首次配对   │ ← 新设备
└──────┬──────┘
       │ App 配对成功
       ▼
┌─────────────┐  电源键  ┌─────────────┐
│ Start of Day│◄────────►│   屏保      │
└──────┬──────┘          └─────────────┘
       │ 任意按键              │
       ▼                       │ 电源键
┌─────────────┐                │
│  Overview   │◄───────────────┘
└──────┬──────┘
       │ 滚轮选择 + 按下
       ▼
┌─────────────┐  完成任务  ┌─────────────┐
│  Task In    │───────────►│ Settlement  │
└──────┬──────┘  (全部完成) └──────┬──────┘
       │ 完成单个任务              │ 任意按键
       └───────────────────────────┘
              返回 Overview
```

**状态说明:**

| 状态 | 描述 |
|------|------|
| 首次配对 | 新设备等待 App 配对 |
| Start of Day | 开机默认页面，显示早安信息 |
| Overview | 主页面，混合时间线显示 |
| Task In | 任务详情页，专注模式 |
| Settlement | 结算页，所有任务完成时显示 |
| 屏保 | 静态宠物图片，BLE 断开省电 |

---

## 5. 宠物系统

### 5.1 宠物形态

| 形态 | 英文名 | 像素图资源 |
|------|--------|------------|
| 猫 | Cat | cat_*.png |
| 狗 | Dog | dog_*.png |
| 兔子 | Bunny | bunny_*.png |
| 鸟 | Bird | bird_*.png |
| 龙 | Dragon | dragon_*.png |

### 5.2 成长阶段

| 阶段 | 英文名 | 解锁条件 |
|------|--------|----------|
| 宝宝 | Baby | 初始阶段 |
| 幼年 | Child | 完成 50 个任务 |
| 少年 | Teen | 完成 150 个任务 |
| 成年 | Adult | 完成 300 个任务 |
| 长老 | Elder | 完成 500 个任务 |

### 5.3 心情状态

| 心情 | 英文名 | 触发条件 |
|------|--------|----------|
| 开心 | Happy | 默认状态 |
| 兴奋 | Excited | 连续完成多个任务 |
| 专注 | Focused | 进入 Task In 页面 |
| 困倦 | Sleepy | 夜间时段 |
| 想念 | Missing You | 长时间未互动 |

### 5.4 像素图资源需求

每个形态需要以下资源:

```
{form}/
├── {stage}/
│   ├── idle.png          # 待机动画 (4 帧)
│   ├── happy.png         # 开心表情
│   ├── excited.png       # 兴奋表情
│   ├── focused.png       # 专注表情
│   ├── sleepy.png        # 困倦表情
│   └── missing.png       # 想念表情
```

**图片规格:**

| 规格 | 4寸屏幕 | 7寸屏幕 |
|------|---------|---------|
| 尺寸 | 64 × 64 px | 128 × 128 px |
| 格式 | 1-bit BMP | 1-bit BMP |
| 颜色 | 黑白 | 黑白 |

---

## 6. 数据同步

### 6.1 BLE 协议概要

详细协议请参考 `BLE-Protocol-Spec.md`。

#### 主要命令

| 命令 | 类型码 | 方向 | 描述 |
|------|--------|------|------|
| DayPack | 0x10 | App → Device | 发送每日数据包 |
| TaskInPage | 0x11 | App → Device | 发送任务详情 |
| DeviceMode | 0x12 | App → Device | 设置设备模式 |
| CompleteTask | 0x11 | Device → App | 任务完成事件 |
| WheelSelect | 0x14 | Device → App | 滚轮选择确认 (发送选中项 ID) |
| ViewEventDetail | 0x15 | Device → App | 查看日程详情 |
| RequestRefresh | 0x20 | Device → App | 请求刷新数据 |
| LowBattery | 0x40 | Device → App | 低电量通知 |

### 6.2 事件发送时机

| 触发条件 | 发送事件 |
|----------|----------|
| 滚轮滚动 | 纯本地处理，不发送事件 |
| 按下确认 (任务) | WheelSelect (发送选中项 ID) |
| 按下确认 (日程) | ViewEventDetail |
| 完成任务 | CompleteTask |
| 电量低于 20% | LowBattery |

### 6.3 数据刷新时机

| 触发条件 | 刷新内容 |
|----------|----------|
| App 启动 | 完整 DayPack |
| 设备连接 | 完整 DayPack |
| 任务状态变更 | 增量更新 |
| 用户手动刷新 | 完整 DayPack |
| 定时刷新 (每小时) | 完整 DayPack |

### 6.4 离线行为

| 场景 | 设备行为 |
|------|----------|
| 未连接 App | 显示缓存数据 |
| 按键完成任务 | 本地标记 + 延迟同步 |
| 跨日未同步 | App 推送新 Day Pack |

---

## 7. 4寸 vs 7.3寸差异

### 7.1 布局适配

#### 4寸屏幕 (400 × 300)

- 紧凑布局
- 宠物图较小 (64 × 64)
- 最多显示 3 条任务
- 单列布局

#### 7.3寸屏幕 (800 × 480)

- 宽松布局
- 宠物图较大 (128 × 128)
- 最多显示 5 条任务
- 可选双列布局

### 7.2 字体大小

| 元素 | 4寸 | 7寸 |
|------|-----|-----|
| 标题 | 16px | 24px |
| 正文 | 12px | 16px |
| 辅助文字 | 10px | 12px |

### 7.3 信息密度

| 内容 | 4寸 | 7寸 |
|------|-----|-----|
| 任务列表 | 3 条 | 5 条 |
| 日程预览 | 1 条 | 3 条 |
| 天气详情 | 仅图标+温度 | 完整信息 |

---

## 8. 固件开发指南

### 8.1 开发环境

| 项目 | 推荐 |
|------|------|
| MCU | ESP32-C3 / nRF52832 |
| IDE | ESP-IDF / Zephyr |
| E-ink 驱动 | GxEPD2 / 厂商 SDK |

### 8.2 内存布局

```
Flash (4MB):
├── Bootloader (64KB)
├── Firmware (1MB)
├── Pet Assets (2MB)
│   ├── cat/ (400KB)
│   ├── dog/ (400KB)
│   ├── bunny/ (400KB)
│   ├── bird/ (400KB)
│   └── dragon/ (400KB)
├── Fonts (512KB)
└── Cache (448KB)
    ├── DayPack (64KB)
    └── Display Buffer (384KB)
```

### 8.3 关键实现点

#### 电源管理

```c
// 休眠唤醒
void enter_deep_sleep() {
    // 保存当前状态
    save_state_to_rtc();
    // 配置唤醒源: 按键 + 定时器
    esp_sleep_enable_ext0_wakeup(BUTTON_PIN, 0);
    esp_sleep_enable_timer_wakeup(SLEEP_DURATION_US);
    esp_deep_sleep_start();
}
```

#### E-ink 刷新策略

```c
typedef enum {
    REFRESH_FULL,      // 全刷新 - 页面切换
    REFRESH_PARTIAL,   // 局部刷新 - 任务状态更新
    REFRESH_FAST       // 快速刷新 - 动画帧
} RefreshMode;
```

#### BLE 数据接收

```c
void on_ble_data_received(uint8_t* data, size_t len) {
    uint8_t type = data[0];
    uint16_t payload_len = (data[1] << 8) | data[2];
    uint8_t* payload = &data[3];

    switch (type) {
        case 0x10: // DayPack
            parse_day_pack(payload, payload_len);
            refresh_display(REFRESH_FULL);
            break;
        case 0x11: // TaskInPage
            parse_task_in_page(payload, payload_len);
            show_task_in_page();
            break;
        // ...
    }
}
```

### 8.4 测试清单

- [ ] BLE 连接稳定性 (连续 24 小时)
- [ ] 电池续航测试 (待机 + 活跃使用)
- [ ] E-ink 刷新质量 (残影、灰度)
- [ ] 按键响应 (防抖、长按检测)
- [ ] 数据解析 (边界条件、异常数据)
- [ ] 离线模式 (缓存、状态恢复)

---

## 附录 A: 术语表

| 术语 | 定义 |
|------|------|
| Day Pack | 每日数据包，包含 4 个页面的所有数据 |
| Event Log | 设备发送给 App 的用户交互事件 |
| Task In | 任务详情页面 |
| Settlement | 每日结算页面 |
| Focus Mode | 专注模式，简化显示 |

## 附录 B: 修订历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0.0 | 2026-01-30 | 初始版本 |
| v1.1.0 | 2026-01-31 | 更新按键配置 (电源键 + 滚轮)、交互流程、状态机、BLE 事件 |
| v1.1.1 | 2026-02-03 | 明确滚轮按键位置为屏幕下方 |
| v1.1.2 | 2026-02-12 | 屏幕规格更新为 Spectra 6 全彩色，7寸改为 7.3寸，4寸分辨率修正，滚轮改为旋钮，新增 SoC 规格 |

---

## 联系方式

如有协议问题或需要澄清，请联系 Kiro 开发团队。
